<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Form to PNG with Image</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
    </style>
</head>

<body>

    <h2>Enter Your Info</h2>
    <form id="infoForm">
        Name: <input type="text" id="name" required><br><br>
        Age: <input type="number" id="age" required><br><br>

        Gender:
        <input type="radio" name="gender" value="Male" required> Male
        <input type="radio" name="gender" value="Female" required> Female<br><br>

        Subscribe to newsletter:
        <input type="checkbox" id="subscribe"><br><br>

        Upload Image: <input type="file" id="imageUpload" accept="image/*"><br><br>

        <button type="submit">Generate PNG</button>
    </form>

    <script>
        document.getElementById('infoForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const name = document.getElementById('name').value;
            const age = document.getElementById('age').value;
            const gender = document.querySelector('input[name="gender"]:checked')?.value || '';
            const subscribe = document.getElementById('subscribe').checked ? 'Yes' : 'No';
            const fileInput = document.getElementById('imageUpload');

            let imgPattern = '';

            if (fileInput.files[0]) {
                // Convert uploaded image to base64
                imgPattern = await new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.readAsDataURL(fileInput.files[0]);
                });
            }

            // Create SVG with user info and optional image pattern
            const svg = `
    <svg xmlns="http://www.w3.org/2000/svg" width="500" height="300">
      <defs>
        ${imgPattern ? `<pattern id="imgPattern" patternUnits="userSpaceOnUse" width="500" height="100">
                          <image href="${imgPattern}" x="0" y="0" width="500" height="100"/>
                        </pattern>` : ''}
      </defs>
      <rect width="100%" height="100%" fill="white"/>
      ${imgPattern ? '<rect x="0" y="0" width="500" height="100" fill="url(#imgPattern)"/>' : ''}
      <text x="50%" y="150" font-family="Arial" font-size="24" text-anchor="middle" fill="black">Name: ${name}</text>
      <text x="50%" y="180" font-family="Arial" font-size="24" text-anchor="middle" fill="black">Age: ${age}</text>
      <text x="50%" y="210" font-family="Arial" font-size="24" text-anchor="middle" fill="black">Gender: ${gender}</text>
      <text x="50%" y="240" font-family="Arial" font-size="24" text-anchor="middle" fill="black">Subscribe: ${subscribe}</text>
    </svg>
  `;

            // Convert SVG to PNG
            const svgBlob = new Blob([svg], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(svgBlob);
            const img = new Image();

            img.onload = function () {
                const canvas = document.createElement('canvas');
                canvas.width = 500;
                canvas.height = 300;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                URL.revokeObjectURL(url);

                const pngUrl = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = pngUrl;
                link.download = 'info.png';
                link.click();
            };

            img.src = url;
        });
    </script>

</body>

</html>