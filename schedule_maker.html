<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>"Education"</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='styles/style1.css'>

</head>



<body>
    <img id="panicBtn" src="images/eye1.png" style="cursor:pointer;" alt="Toggle">
    <form class="page" id="myForm">
        <div class="main">
            <h1>Classes:</h1>
            <div class="horizontal" id="scheduleContainer"></div>
        </div>


        <div style="text-align:center; margin:20px;">
            <button type="button" id="generateBtn">Generate PNG Schedule</button>
        </div>
    </form>
</body>




<template id="options-classes">
    <option value=""></option>
    <option>Math</option>
    <option>Dance</option>
    <option>P.E.</option>
</template>

<script src="scripts/panic_button.js"></script>
<script src="scripts/file_button.js"></script>
<script>
    window.onbeforeunload = function () {
        window.scrollTo(0, 0);
    };

    // Days and time slots
    const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];
    const times = [
        "08:00 - 09:30",
        "10:00 - 11:30",
        "12:00 - 13:30",
        "14:00 - 15:30",
        "16:00 - 17:30",
        "18:00 - 19:30",
        "20:00 - 21:30"
    ];

    const scheduleContainer = document.getElementById('scheduleContainer');
    const template = document.getElementById('options-classes').content;

    // Generate schedule dynamically
    days.forEach((day, dayIndex) => {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'vertical bordered';

        const h2 = document.createElement('h2');
        h2.textContent = day + ":";
        dayDiv.appendChild(h2);

        times.forEach((time, timeIndex) => {
            const label = document.createElement('label');
            label.className = 'label';

            const img = document.createElement('img');
            img.src = "images/freetime.png";

            const h3 = document.createElement('h3');
            h3.textContent = time;

            const select = document.createElement('select');
            select.name = day.toLowerCase().slice(0, 3) + (timeIndex + 1);
            select.className = 'classes';
            select.appendChild(template.cloneNode(true));

            label.appendChild(img);
            label.appendChild(h3);
            label.appendChild(select);
            dayDiv.appendChild(label);
        });

        scheduleContainer.appendChild(dayDiv);
    });

    // Map of class names to image paths
    const classImages = {
        "Math": "images/schedule/math.png",
        "Dance": "images/schedule/dance.png",
        "P.E.": "images/pe.png"
    };

    // Add event listener to each select (after DOM build)
    document.addEventListener('change', function (e) {
        if (e.target.matches('select.classes')) {
            const selectedValue = e.target.value;
            const imgElement = e.target.closest('label').querySelector('img');

            imgElement.src = classImages[selectedValue] || "images/freetime.png";
        }
    });
</script>

<script>
    document.getElementById('generateBtn').addEventListener('click', function () {
        // Gather schedule data
        const selects = document.querySelectorAll('select.classes');
        const data = [];

        selects.forEach(select => {
            const day = select.name.slice(0, 3); // mon, tue, etc.
            const timeIndex = parseInt(select.name.slice(3)) - 1;
            const value = select.value || 'Free';
            data.push({ day, timeIndex, value });
        });

        // SVG settings
        const width = 800;
        const height = 500;
        const dayLabels = ["Mon", "Tue", "Wed", "Thu", "Fri"];
        const timeLabels = [
            "08:00 - 09:30",
            "10:00 - 11:30",
            "12:00 - 13:30",
            "14:00 - 15:30",
            "16:00 - 17:30",
            "18:00 - 19:30",
            "20:00 - 21:30"
        ];

        // Build SVG with your CSS style
        let svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}">
    <defs>
        <pattern id="paperTexture" patternUnits="userSpaceOnUse" width="50" height="50">
            <image href="../images/paper.png" x="0" y="0" width="50" height="50" />
        </pattern>
        <filter id="shadow">
            <feDropShadow dx="2" dy="2" stdDeviation="2" flood-color="#00000088"/>
        </filter>
    </defs>
    <rect width="100%" height="100%" fill="#f2d9f2" stroke="#000000" stroke-width="6" rx="10" ry="10" filter="url(#shadow)"/>
    <style>
        .day { font: bold 16px sans-serif; fill: black; }
        .time { font: 12px sans-serif; fill: black; }
        .class { font: 14px sans-serif; fill: black; }
        rect.cell { fill: #f2d9f2; stroke: black; stroke-width: 3; rx: 8; ry: 8; filter: url(#shadow);}
    </style>
`;

        const cellWidth = width / (dayLabels.length + 1);
        const cellHeight = height / (timeLabels.length + 1);

        // Days header (centered with full names)
        const fullDayNames = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];

        fullDayNames.forEach((d, i) => {
            const x = (i + 1) * cellWidth + cellWidth / 2;
            const y = cellHeight / 2; // header row center
            svg += `<text x="${x}" y="${y}" class="day" text-anchor="middle" dominant-baseline="middle">${d}</text>`;
        });

        // Times + grid + classes
        timeLabels.forEach((t, row) => {
            const y = (row + 1) * cellHeight;

            // Time column: centered vertically in the first column
            svg += `<text x="${cellWidth / 2}" y="${y + cellHeight / 2}" 
                class="time" text-anchor="middle" dominant-baseline="middle">${t}</text>`;

            // When creating the grid, update each cell:
            dayLabels.forEach((d, col) => {
                const x = (col + 1) * cellWidth;
                svg += `<rect class="cell" x="${x + 5}" y="${y + 5}" width="${cellWidth - 10}" height="${cellHeight - 10}" />`;

                const item = data.find(item => item.day === d.toLowerCase().slice(0, 3) && item.timeIndex === row);
                if (item) {
                    svg += `<text x="${x + cellWidth / 2}" y="${y + cellHeight / 2}" 
            class="class" text-anchor="middle" dominant-baseline="middle">${item.value}</text>`;
                }
            });
        });

        svg += `</svg>`;

        // Convert SVG to PNG
        const img = new Image();
        const svgBlob = new Blob([svg], { type: 'image/svg+xml;charset=utf-8' });
        const url = URL.createObjectURL(svgBlob);

        img.onload = function () {
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0);
            URL.revokeObjectURL(url);

            // Download PNG
            const link = document.createElement('a');
            link.download = 'schedule.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        };
        img.src = url;
    });
</script>

</html>